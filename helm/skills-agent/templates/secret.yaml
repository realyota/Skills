{{- if and .Values.storeResults.enabled (not .Values.storeResults.iamRoleArn) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "skills-agent.fullname" . }}-aws-credentials
  labels:
    {{- include "skills-agent.labels" . | nindent 4 }}
type: Opaque
data:
  aws-access-key-id: {{ .Values.storeResults.awsAccessKeyId | b64enc | quote }}
  aws-secret-access-key: {{ .Values.storeResults.awsSecretAccessKey | b64enc | quote }}
{{- end }}
---
{{- if .Values.credentials.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "skills-agent.secretName" . }}
  labels:
    {{- include "skills-agent.labels" . | nindent 4 }}
type: Opaque
stringData:
  codex-auth.json: |
    {{- .Values.credentials.codexAuth | nindent 4 }}
  claude-credentials.json: |
    {{- .Values.credentials.claudeCredentials | nindent 4 }}
  clickhouse-client-config.xml: |
    <clickhouse>
      <host>{{ .Values.clickhouse.host }}</host>
      <port>{{ .Values.clickhouse.port }}</port>
      <user>{{ .Values.clickhouse.user }}</user>
      <password>{{ .Values.clickhouse.password }}</password>
      {{- if .Values.clickhouse.tls.enabled }}
      <secure>1</secure>
      {{- if .Values.clickhouse.tls.ca }}
      <caConfig>/etc/clickhouse-client/ca.crt</caConfig>
      {{- end }}
      {{- if .Values.clickhouse.tls.cert }}
      <certificateFile>/etc/clickhouse-client/client.crt</certificateFile>
      {{- end }}
      {{- if .Values.clickhouse.tls.key }}
      <privateKeyFile>/etc/clickhouse-client/client.key</privateKeyFile>
      {{- end }}
      {{- end }}
    </clickhouse>
  altinity-mcp-config.yaml: |
    clickhouse:
      host: {{ .Values.clickhouse.host }}
      port: {{ .Values.clickhouse.port }}
      user: {{ .Values.clickhouse.user }}
      password: {{ .Values.clickhouse.password }}
      tls:
        enabled: {{ .Values.clickhouse.tls.enabled }}
        {{- if .Values.clickhouse.tls.ca }}
        ca_file: /etc/altinity-mcp/ca.crt
        {{- end }}
        {{- if .Values.clickhouse.tls.cert }}
        cert_file: /etc/altinity-mcp/client.crt
        {{- end }}
        {{- if .Values.clickhouse.tls.key }}
        key_file: /etc/altinity-mcp/client.key
        {{- end }}
  {{- if .Values.clickhouse.tls.ca }}
  clickhouse-ca.crt: |
    {{- .Values.clickhouse.tls.ca | nindent 4 }}
  {{- end }}
  {{- if .Values.clickhouse.tls.cert }}
  clickhouse-client.crt: |
    {{- .Values.clickhouse.tls.cert | nindent 4 }}
  {{- end }}
  {{- if .Values.clickhouse.tls.key }}
  clickhouse-client.key: |
    {{- .Values.clickhouse.tls.key | nindent 4 }}
  {{- end }}
{{- end }}
